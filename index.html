<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Async Weather Tracker </title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>
        üå¶Ô∏è Async Weather Tracker
    </h1>
    <button id="dark-toggle">üåô Dark Mode</button>
    <div id="search-box">

        <div id="first-search">
            <h3>Search City</h3>
            <form action="">
                <input type="text" id="search-city" placeholder="Delhi,Mumbai etc......">
                <button type="submit">Search</button>
            </form>
        </div>
        <div id="search-history">
            <h3>Search History</h3>
            <button id="clear-all">üóë Clear All</button>
            <div id="search-cities-box">

            </div>
        </div>
    </div>

    <div id="Weather-info-box">
        <h3>Weather Info</h3>
        <div id="fetched-data-box">

        </div>
    </div>

    <script>
        let API_KEY = "ea0beec1a1a15e6771b7ecdc73f830ec";

        let form = document.querySelector('form')
        let city = document.querySelector("#search-city")
        let weather = document.querySelector('#fetched-data-box')
        let searchcity = document.querySelector('#search-cities-box')
        let darkBtn = document.getElementById("dark-toggle")
        let clearAllBtn = document.getElementById("clear-all");


        async function getWeatherInfo(city) {

            if (city.trim() === "") return;

            let response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`
            );

            let data = await response.json();

            if (data.cod !== 200) {
                weather.innerHTML = "<p>City not found ‚ùå</p>";
                return;
            }

            let card = document.createElement('div');
            card.innerHTML = `
        <div><b>City :</b> ${data.name}, ${data.sys.country}</div>
        <div><b>Temp :</b> ${data.main.temp}¬∞C</div>
        <div><b>Weather :</b> ${data.weather[0].main}</div>
        <div><b>Humidity :</b> ${data.main.humidity}%</div>
        <div><b>Wind :</b> ${data.wind.speed} m/s</div>
    `;

            weather.innerHTML = "";
            weather.append(card);

            let cities = JSON.parse(localStorage.getItem("cities")) || [];

            if (!cities.includes(city)) {
                cities.push(city);
                localStorage.setItem("cities", JSON.stringify(cities));
            }

            displayHistory();
        }

        function displayHistory() {
            let cities = JSON.parse(localStorage.getItem("cities")) || [];

            searchcity.innerHTML = "";

            cities.forEach((cityName, index) => {

                let item = document.createElement("div");
                item.classList.add("history-item");

                let cityText = document.createElement("span");
                cityText.textContent = cityName;

                cityText.addEventListener("click", () => {
                    getWeatherInfo(cityName);
                });

                let deleteBtn = document.createElement("button");
                deleteBtn.textContent = "‚úñ";
                deleteBtn.classList.add("delete-btn");

                deleteBtn.addEventListener("click", () => {
                    cities.splice(index, 1);
                    localStorage.setItem("cities", JSON.stringify(cities));
                    displayHistory();
                });

                item.appendChild(cityText);
                item.appendChild(deleteBtn);

                searchcity.appendChild(item);
            });
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault()
            getWeatherInfo(city.value)
        })
        displayHistory();
        clearAllBtn.addEventListener("click", () => {

            localStorage.removeItem("cities");

            weather.innerHTML = "<p>No city selected.</p>";
            currentDisplayedCity = null;

            displayHistory();
        });

        if (localStorage.getItem("theme") === "dark") {
            document.body.classList.add("dark");
            darkBtn.textContent = "‚òÄ Light Mode";
        }

        darkBtn.addEventListener("click", () => {
            document.body.classList.toggle("dark");

            if (document.body.classList.contains("dark")) {
                localStorage.setItem("theme", "dark");
                darkBtn.textContent = "‚òÄ Light Mode";
            } else {
                localStorage.setItem("theme", "light");
                darkBtn.textContent = "üåô Dark Mode";
            }
        });


    </script>
</body>

</html>